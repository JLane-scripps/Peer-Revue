<!DOCTYPE html>
 <!-- Jordan A  -->
  <!--This is the HTML file that defines our components and their functions !  -->
<html>
<head> 
     <base target="_top">
<style>
/********************************************** 
 Define .center class
 It moves all components to the center 
 ********************************************/ 
 .center{
margin: auto;
padding: 10px;
height: 100px; 
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
}
/*************************************************
  Define .pointsBox class 
************************************************/
.pointsBox{
  margin: auto;
  padding: 10px;

/* Set size of Box */
  width: 200px;
  height: 50px;
  
  /* Center Align */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;

  /* Set background color and border */
  background-color: white;
  border: 3px black;
}
 </style>
</head> 

 <!-- Body Begins now, we can use the classes we defined above -->
<body>

<!-- Declare these variables in a global scope so that is accessible throughout the script -->
<script>
var points = 0;
var username ="Dr. Dreamy";
var rewardText ="";
var previousColor = "";
var numWords;
var numParagraphs = 0;
// Init num words
function initWordCount(initialWordCount){
  numWords  = initialWordCount;
}
google.script.run.withSuccessHandler(initWordCount).howManyWords();

// Init num paragraphs
function initParagraphCount(initialParagraphCount){
  numParagraphs = initialParagraphCount;
}
google.script.run.withSuccessHandler(initParagraphCount).howManyParagraphs();

// init aquariumHtml
function initAquariumHtml(html){
  aquariumHtml = html;
}
google.script.run.withSuccessHandler(initAquariumHtml).getAquariumHtml();
</script>

<!---- Display Username ---->
<div class= "center">
<h2 id="username"></h2>
</div>

<!------ Display Points ----->
<div class="pointsBox">
<h2 id="points"></h2>
</div>

<!--- Display text to communicate with the user when they get a reward of some kind. --->
<div class="center">
<p id="rewardText"></p>


<script>
document.getElementById("points").innerHTML = points;
document.getElementById("username").innerHTML = username;

// Set default color of background 
document.querySelector("body").style.backgroundColor = "lightblue";
</script>


<!------ Display Message to user that  



<!-- Script that interfaces with Google Docs api to update points  -->
<script>  

    function retrieveHowManyWordsFromGoogleDocs(words) {
        // Calculate if there are any new words
        var wordIncrease = words - numWords;

        var pointIncrease = wordIncrease *2; // + 2 for each new word

        if(wordIncrease > 0){
          // Add new points
          points+=pointIncrease 
          rewardText = " Keep going! +" + pointIncrease.toString();
          document.getElementById('points').innerHTML = points;
          document.getElementById("rewardText").innerHTML = rewardText;
        }

       //update numWords
       numWords+=wordIncrease;
      }


    function retrieveHowManyParagraphsFromGoogleDocs(paragraphs){
        // Calculate if there are any new paragraphs
        var paraIncrease = paragraphs - numParagraphs;

        var pointIncrease = paraIncrease * 50; // + 50 for each new paragraph
        if(paraIncrease > 0){
          // Add new points
          points +=pointIncrease;
          rewardText = " New Paragraphs added +" + pointIncrease.toString();
          document.getElementById('points').innerHTML = points;
          document.getElementById("rewardText").innerHTML = rewardText;
        }

       //update numParagraphs
       numParagraphs += paraIncrease;
    }
 
    /* Functions that call google.script.run so that they can be set to
     be ran at a certain interval */ 
     function checkForWordIncrease(){
      google.script.run.withSuccessHandler(retrieveHowManyWordsFromGoogleDocs).howManyWords();
    }      
     function checkForParagraphIncrease(){
      google.script.run.withSuccessHandler(retrieveHowManyParagraphsFromGoogleDocs).howManyParagraphs();
    }      

    /* Set an interval so that we are regularly retrieving 
     a word count from google docs
     1000 miliseconds = 1 second. */
    setInterval(checkForWordIncrease,2000);

    /* Set another interval, but make sure that it is different than 
     the other interval so that these calls are not competing with eachother. */
    setInterval(checkForParagraphIncrease, 5500);

    // Increase points and reward user for customizing their invironment
    function customizationBonus(){
      points+=1;
      rewardText = "You updated your environment! + 1 ";
      document.getElementById("points").innerHTML = points;
      document.getElementById("rewardText").innerHTML = rewardText;
    }
</script>

<!-- Customize Options -->  
      <details>
        <summary>Customize Options</summary>
        <!-- Give component description to user -->
        <summary>Select a background color:</summary>
        <input type="color" id="color-picker" name="color-picker">
         <!-- Assign button function -->
         <button id="apply-color-button">Apply Color</button>
      </details>

 <!-- Mini Games ---> 
       <details>
        <summary>Mini Games </summary>
        <!-- Give component description to user -->
        <button id="aquariumButton">Aquarium</button>
      </details>


    </div>

 <!-- Assign functions to buttons  -->
    <script>
      /* Background color changing button functionality */ 
      document.getElementById("apply-color-button").addEventListener("click", function() {
        // Get the input elements
        var colorInput = document.getElementById("color-picker");
        var imageInput = document.getElementById("image-picker");

        // Get the body element
        var body = document.querySelector("body");

        // Set the background color
        if (colorInput.value != "" &&  (colorInput.value != previousColor)) {
          body.style.backgroundColor = colorInput.value;
          // Call customization Bonus
          customizationBonus();
         
        } 
        previousColor = colorInput.value;
      });


    
   

    /* Aquarium button functionality  */
    document.getElementById("aquariumButton").addEventListener("click", function() {
         aquariumWindow = window.open("", " Aquarium ", "location=1,status=1,scrollbars=1,width=800,height=800");
         // write html data to window 
         aquariumWindow.document.write(aquariumHtml);
        }); 
    
    </script>
  

 </body> <!-- End of Body -->

</html>


